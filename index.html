<!DOCTYPE html>
<html lang="pt">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9FH2K8V65B"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9FH2K8V65B');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Anatomia</title>
    <link rel="icon" href="https://static.vecteezy.com/system/resources/previews/011/116/298/original/continuous-line-drawing-of-a-human-brain-free-vector.jpg" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+15&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Jersey 15';
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0; /* Cor de fundo padr√£o */
            background-image: url('https://i.imgur.com/naeZ29X.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-color 0.5s ease-in-out; /* Transi√ß√£o suave para troca de fundo */
        }

        body.no-background {
            background-image: none;
        }

        .menu, .sub-menu, .cranio-sub-menu, .medula-sub-menu, .vertebra-sub-menu, .mode-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80%;
            max-width: 500px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 4px solid #5A3E2B; 
            padding: 30px;
            position: relative;
            border-radius: 15px;
            box-shadow: 0px 7px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        

        .menu h1, .sub-menu h1, .cranio-sub-menu h1, .medula-sub-menu h1, .vertebra-submenuh1, .mode-menu h1 {
            color: #920000;
            font-size: 2.5em;
            text-shadow: 2px 2px 0 #ffffff;
            margin-bottom: 20px;
            text-align: center;
        }

        p {
            font-size: 18px;
            color: #555;
        }
        

        /* Estiliza√ß√£o dos bot√µes em vermelho burgundy */
        .menu button, 
        .sub-menu button, 
        .cranio-sub-menu button,
        .medula-sub-menu button,
        .vertebra-sub-menu button,
        .mode-menu button {
                /* Tamanho do bot√£o */
                width: 300px; /* Largura da imagem */
                height: 70px; /* Altura da imagem */

                font-family: 'Jersey 15', cursive; /* Fonte retr√¥ */
                font-size: 20px;
                color: #fff; /* Texto branco */
                text-shadow: 2px 2px 0 #000; /* Sombra no texto */
                display: inline-block; /* Faz o bot√£o se comportar como um bloco inline *


                /* Imagem de fundo */
                background-image: url('https://i.imgur.com/dHWvqGk.png');
                background-color: #00000000;
                background-size: cover; /* Garante que a imagem cubra todo o bot√£o */
                display: block; /* Remove o espa√ßo extra embaixo da imagem */
                
                

                /* Remove estilos padr√£o do bot√£o */
                border: none;
                outline: none;
                cursor: pointer;
                padding: 0;
                margin: 0;
                box-shadow: none;
                cursor: pointer;
                object-fit: cover; /* Garante que a imagem cubra o espa√ßo sem distorcer */
                line-height: 0; /* Remove espa√ßos extras dentro do bot√£o */

        }

        .menu button:hover, 
        .sub-menu button:hover, 
        .cranio-sub-menu button:hover,
        .medula-sub-menu button:hover,
        .vertebra-sub-menu button:hover,
        .mode-menu button:hover {
            filter: brightness(1.2); /* Clareia o bot√£o */
            transition: all 0.2s ease; /* Suaviza a transi√ß√£o */
        }

        .menu button:active, 
        .sub-menu button:active, 
        .cranio-sub-menu button:active,
        .medula-sub-menu button:active,
        .vertebra-sub-menu button:active,
        .mode-menu button:active {
               /* Efeito de pressionado */
            box-shadow:
                1px 1px 0 #000,
                2px 2px 0 #000,
                3px 3px 0 #000;
            transform: translate(3px, 3px); /* Move o bot√£o para simular o clique */
        }

        .menu button:focus, 
        .sub-menu button:focus, 
        .cranio-sub-menu button:focus,
        .medula-sub-menu button:focus,
        .vertebra-sub-menu button:focus,
        .mode-menu button:focus {
            outline: none;
            box-shadow: 0 0 5px #800020;
        }

        .game {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
            background-image: url('https://i.imgur.com/PUf8wJf.jpg'); /* Imagem de fundo do jogo */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: auto;
            z-index: 1000; /* Garante que o jogo fique acima de outros elementos */
        }

        .game.active {
            opacity: 1;
        }

        .container {
            position: relative;
            display: inline-block;
            border: 5px solid #333;
            border-radius: 10px;
            background: white;
            padding: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        .target {
            position: absolute;
            background-color: rgba(255, 247, 6, 0.64);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .target.correct {
            background-color: rgba(0, 255, 0, 0.7);
        }

        .target.incorrect {
            background-color: rgba(255, 0, 0, 0.7);
        }

        .blinking {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #28a745; /* Barra de progresso verde */
            width: 0;
            transition: width 0.5s ease-in-out;
        }

        #feedback {
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        /* Destaque para a pergunta */
        #question {
            background-color: rgba(128, 0, 32, 0.8); /* burgundy transl√∫cido */
            border-radius: 12px;
            padding: 10px;
            color: white;
            font-style: italic;
        }

        .structure-name {
            font-weight: bold;
            color: white;
            text-transform: uppercase;
        }

        /* Rodap√© com copyright */
        .copyright {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8); /* Fundo transparente */
            font-size: 14px;
            color: #333;
        }
        
        .visual-novel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            z-index: 1000;
            overflow: hidden;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -1; /* Coloca o fundo atr√°s do conte√∫do */

        }

        .dialogue-container {
            display: flex;
            align-items: flex-end;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }

        .medic-frame {
            width: 200px;
            height: 300px;
            background-color: #fff;
            border: 5px solid #800020;
            border-radius: 10px;
            margin-right: 20px;
            overflow: hidden;
        }

        .medic-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;

        }

        .dialogue-box {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            width: 70%;
            max-width: 800px;
            text-align: left;
        }

        .dialogue-box p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .dialogue-box button {
            padding: 10px 20px;
            background-color: #800020;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow:
                1px 1px 0 #000,
                2px 2px 0 #000,
                3px 3px 0 #000;
        }

        .dialogue-box button:hover {
            background-color: #600018;
        }

        .dialogue-box button:active {
            transform: translate(3px, 3px); /* Move o bot√£o para simular o clique */
        }

        .visual-novel-choice {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow: hidden;
        }

        .choice-box {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 600px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        .choice-box h1 {
            color: #800020;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .choice-box button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #800020;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
        }

        .choice-box button:hover {
            background-color: #600018;
        }

        /* Estilo base para todos os menus no estilo visual novel */
        .visual-novel-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow: hidden;
            overflow: auto;
        }

        .visual-novel-menu .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -1;
        }

        .visual-novel-menu .choice-box {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 600px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            
        }

        .visual-novel-menu .choice-box h1 {
            color: #800020;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .visual-novel-menu .choice-box button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #800020;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
        }

        .visual-novel-menu .choice-box button:hover {
            background-color: #600018;
        }

        .game-content {
            background-color: rgba(255, 255, 255, 0.9); /* Fundo branco semi-transparente */
            padding: 20px;
            border-radius: 15px;
            max-width: 800px;
            margin: 20px auto; /* Centraliza o conte√∫do */
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        #timer {
            font-size: 24px;
            font-weight: bold;
            color: #800020;
            margin: 20px 0;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

    </style>
</head>
<body>
    <audio id="background-music" loop volume="0.4">
        <source src="A Lonely Cherry Tree üå∏ - Pix.mp3" type="audio/mpeg">
        Seu navegador n√£o suporta o elemento de √°udio.
    </audio>
    <audio id="correct-sound">
        <source src="/game/Correct Answer Sound Effect.mp3" type="audio/mpeg">    
    </audio>
    <audio id="wrong-sound">
        <source src="/game/videoplayback.m4a" type="audio/mpeg">
    </audio>
    <audio id="victory-sound">
        <source src="/game/videoplayback%20(1).m4a" type="audio/mpeg">
    </audio>
    <!-- Menu Principal -->
    <div class="menu" id="menu">
        <h1>Bem-vindo ao Quiz de Neuroanatomia da T24!</h1>
        <button onclick="showSubMenu()">Iniciar</button>
        <!-- Rodap√© com copyright -->
        <div class="copyright">
            ¬© 2025 - Ianny Miranda. Todos os direitos reservados
        </div>
    </div>

    <!-- Cena de Visual Novel -->
    <div class="visual-novel" id="visual-novel" style="display: none;">
        <div class="background" id="visual-novel-background"></div>
        <div class="dialogue-container">
            <div class="medic-frame">
                <img src="https://i.imgur.com/jeUdHBc.png" alt="Dra. Silva">
            </div>
            <div class="dialogue-box">
                <p id="dialogue-text">Bem-vindo ao Hospital Geral. Eu sou a Dra. Silva. Como posso ajud√°-lo hoje?</p>
                <button onclick="nextDialogue()">Continuar</button>
            </div>
        </div>
    </div>

<!-- Menu de Escolha de Fase -->
<div class="visual-novel-menu" id="visual-novel-choice" style="display: none;">
    <div class="background" id="visual-novel-choice-background"></div>
    <div class="choice-box">
        <h1>O que voc√™ gostaria de aprender hoje?</h1>
        <button onclick="chooseVertebraSublevel()">V√©rtebras</button>
        <button onclick="chooseCranioSublevel()">Ossos do Cr√¢nio</button>
        <button onclick="chooseMedulaSublevel()">Medula Espinal</button>
        <button onclick="startProvaMode()">Modo PROVA PR√ÅTICA 1</button>
    </div>
</div>

<!-- Menu de Escolha de Subn√≠vel do Cr√¢nio -->
<div class="visual-novel-menu" id="cranio-sublevel-choice" style="display: none;">
    <div class="background" id="cranio-sublevel-background"></div>
    <div class="choice-box">
        <h1>Escolha a vista do cr√¢nio</h1>
        <button onclick="chooseMode('cranio', 'anterior')">Vista Anterior</button>
        <button onclick="chooseMode('cranio', 'orbital')">Vista Orbital</button>
        <button onclick="chooseMode('cranio', 'lateral')">Vista Lateral</button>
        <button onclick="chooseMode('cranio', 'posterior')">Vista Posterior</button>
        <button onclick="chooseMode('cranio', 'inferior')">Vista Inferior</button>
        <button onclick="chooseMode('cranio', 'mandibula')">Vista Mand√≠bula</button>
        <button onclick="chooseMode('cranio', 'calota_craniana')">Calota Craniana</button>
        <button onclick="chooseMode('cranio', 'interior')">Vista Interior</button>
        <button onclick="chooseMode('cranio', 'superior')">Vista Superior</button>
        <button onclick="backToVisualNovelChoice()">Voltar</button>
    </div>
</div>

<!-- Menu de Escolha de Subn√≠vel da Medula -->
<div class="visual-novel-menu" id="medula-sublevel-choice" style="display: none;">
    <div class="background" id="medula-sublevel-background"></div>
    <div class="choice-box">
        <h1>Escolha a vista da medula</h1>
        <button onclick="chooseMode('medula', 'coluna_espinal_completa')">Coluna Espinal Completa</button>
        <button onclick="chooseMode('medula', 'vista_superior')">Vista Superior</button>
        <button onclick="chooseMode('medula', 'vista_anterior_nervos')">Vista Anterior com Nervos</button>
        <button onclick="chooseMode('medula', 'vista_posterior_sem_nervos')">Vista Posterior sem Nervos</button>
        <button onclick="backToVisualNovelChoice()">Voltar</button>
    </div>
</div>

<!-- Menu de Escolha de Subn√≠vel das V√©rtebras -->
<div class="visual-novel-menu" id="vertebra-sublevel-choice" style="display: none;">
    <div class="background" id="vertebra-sublevel-background"></div>
    <div class="choice-box">
        <h1>Escolha a vista da v√©rtebra</h1>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_atlas')">V√©rtebra Atlas</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_axis')">Vista Superior da V√©rtebra Axis</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_axis_inferior')">Vista Inferior da V√©rtebra Axis</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_tipica')">Vista Anterior da V√©rtebra T√≠pica</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_tipica_inferior')">Vista Inferior da V√©rtebra At√≠pica</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_sacral')">Sacro + C√≥ccix anterior</button>
        <button onclick="chooseMode('v√©rtebra', 'vertebra_sacral_posterior')">Sacro + C√≥ccix posterior</button>
        <button onclick="backToVisualNovelChoice()">Voltar</button>
    </div>
</div>

<!-- Menu de Escolha de Modo -->
<div class="visual-novel-menu" id="mode-menu" style="display: none;">
    <div class="background" id="mode-menu-background"></div>
    <div class="choice-box">
        <h1>Escolha o modo</h1>
        <button onclick="startGame(currentPhase, currentView, 'padrao')">Modo Memoriza√ß√£o</button>
        <button onclick="startGame(currentPhase, currentView, 'escrita')">Modo Escrita</button>
        <button onclick="backToSublevelChoice()">Voltar</button>
    </div>
</div>



    <!-- Jogo -->
    <div class="game" id="game">
        <div class="game-content">
            <h1>Quiz de Anatomia</h1>
            <div id="timer" style="font-size: 24px; font-weight: bold; color: #800020; margin: 20px 0;">
                Tempo restante: <span id="time">30</span>s
            </div>
            <div class="question-container" id="question-container">
                <p id="question"></p>
            </div>
            <div class="container">
                <img id="image" src="" width="100%">
                <div id="targets"></div>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progress-bar"></div>
            </div class="dialogue-box">
            <p id="feedback" style="font-size: 20px; font-weight: bold; margin-top: 10px;"></p>
            <p id="score">Acertos: 0 / 0 (0%)</p>
            <p id="congrats" style="display:none; color: green; font-weight: bold;">
                üéâ Parab√©ns! Voc√™ acertou todas as perguntas! üéâ
            </p>
            <button id="voltar-button" onclick="backToSubMenu()">Voltar</button>
            <button id="continuar-button" style="display: none;" onclick="showFeedbackMedica()">Continuar</button>
        </div>
    </div>

        <!-- Feedback da M√©dica -->
    <div class="visual-novel" id="feedback-medica" style="display: none;">
        <div class="background" id="feedback-medica-background" style="background-image: url('https://i.imgur.com/PUf8wJf.jpg');"></div>
        <div class="background" id="feedback-medica-background"></div>
        <div class="dialogue-container">
            <div class="medic-frame">
                <img id="medic-sprite" src="" alt="Dra. Silva">
            </div>
            <div class="dialogue-box">
                <p id="feedback-text"></p>
                <button onclick="backToMenu()">Voltar ao Menu</button>
            </div>
        </div>
    </div>

    <script>
                // Verifica se o usu√°rio est√° em um dispositivo m√≥vel
                function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        }

        // Exibe um aviso se o usu√°rio estiver em um dispositivo m√≥vel
        function checkMobileDevice() {
            if (isMobileDevice()) {
                alert("A vers√£o mobile do jogo ainda n√£o est√° pronta. Por favor, acesse pelo computador.");
                // Redireciona para uma p√°gina de aviso ou impede o acesso ao jogo
                window.location.href = "aviso-mobile.html"; // Substitua pelo URL da p√°gina de aviso, se necess√°rio
            }
        }

                // Chama a fun√ß√£o de verifica√ß√£o quando a p√°gina √© carregada
                window.onload = checkMobileDevice;

        const phases = {
            cranio: {
                anterior: {
                    image: "https://i.imgur.com/JlM0A6A.png", // Link da imagem frontal
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "260px", left: "200px", name: "Glabela" },
                        { top: "400px", left: "140px", name: "Maxila" },
                        { top: "380px", left: "200px", size: "large", name: "Abertura piriforme" },
                        { top: "405px", left: "175px", size: "small", name: "Concha nasal inferior" },
                        { top: "365px", left: "175px", size: "small", name: "Conha nasal m√©dia" },
                        { top: "140px", left: "200px", size: "large", name: "Osso frontal" },
                        { top: "500px", left: "200px", size: "large", name: "Processos alveolares" },
                        { top: "420px", left: "200px", size: "small", name: "Septo nasal" },
                        { top: "240px", left: "330px", name: "Superc√≠lio" },
                        { top: "300px", left: "100px", size: "large", name: "√ìrbita" },
                        { top: "380px", left: "50px", name: "Osso zigm√°tico" },
                    ]
                },
                orbital: {
                    image: "https://i.imgur.com/ufGdxRu.png", // Link da imagem frontal
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "230px", left: "140px", name: "Fissura orbital inferior" },
                        { top: "130px", left: "160px", name: "Fissura orbital superior" },
                        { top: "80px", left: "200px", name: "Face orbital do osso frontal" },
                        { top: "160px", left: "120px", name: "Face orbital do osso esfenoide" },
                        { top: "150px", left: "230px", name: "L√¢mina orbital do osso etm√≥ide" },
                        { top: "230px", left: "80px", name: "Face orbital do osso zigom√°tico" },
                        { top: "210px", left: "200px", name: "Face orbital da maxila" },
                        { top: "140px", left: "261px", size: "small", name: "Osso lacrimal" },
                        { top: "180px", left: "270px", size: "small", name: "Ducto lacrimal" },
                    ]
                },
                lateral: {
                    image: "https://i.imgur.com/KLwGBRj.png", // Link da imagem lateral
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "80px", left: "90px", size: "large", name: "Osso parietal" },
                        { top: "220px", left: "130px", size: "large", name: "Osso temporal" },
                        { top: "270px", left: "270px", name: "Osso zigom√°tico" },
                        { top: "275px", left: "200px", size: "small", name: "Arco zigom√°tico" },
                        { top: "200px", left: "220px", name: "Asa maior do esfenoide" },
                        { top: "300px", left: "110px", size: "small", name: "Processo mast√≥ide do temporal" },
                        { top: "275px", left: "130px", size: "small", name: "Meato ac√∫stico externo" },
                        { top: "80px", left: "280px", size: "large", name: "Osso frontal" },
                        { top: "80px", left: "160px", size: "small", name: "Sutura coronal" },
                        { top: "180px", left: "220px", size: "small", name: "Sutura esfeno-frontal" },
                        { top: "180px", left: "190px", size: "small", name: "Sutura esfeno-parietal" },
                        { top: "180px", left: "130px", size: "small", name: "Sutura escamosa" },
                        { top: "200px", left: "190px", size: "small", name: "Sutura esfeno-temporal" },
                    ]
                },
                mandibula: {
                    image: "https://i.imgur.com/8cbQjSf.png", // Link da imagem da mand√≠bula
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "270px", left: "170px", name: "√Çngulo da mand√≠bula" },
                        { top: "200px", left: "120px", name: "Ramo da mand√≠bula" },
                        { top: "80px", left: "50px", name: "Processo condilar da mand√≠bula" },
                        { top: "250px", left: "300px", name: "Corpo da mand√≠bula" },
                        { top: "250px", left: "450px", name: "Mento" },
                    ]
                },
                posterior: {
                    image: "https://i.imgur.com/kO3G1Ew.png", // Link da imagem posterior
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "168px", left: "140px", size: "small", name: "Protuber√¢ncia occipital externa" },
                        { top: "175px", left: "125px", size: "small", name: "√çneo" },
                        { top: "110px", left: "120px", size: "large", name: "Osso occipital" },
                        { top: "40px", left: "180px", size: "large", name: "Osso parietal" },
                        { top: "165px", left: "50px", size: "small", name: "Linha superior da nuca" },
                    ]
                },
                inferior: {
                    image: "https://i.imgur.com/YRnucHu.png", // Link da vista inferior
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "110px", left: "230px", size: "small", name: "Osso palatino" },
                        { top: "155px", left: "160px", size: "small", name: "Osso esfenoide" },
                        { top: "220px", left: "130px", name: "Osso temporal" },
                        { top: "310px", left: "220px", size: "large", name: "Osso occipital" },
                        { top: "135px", left: "205px", size: "small", name: "Coano" },
                        { top: "145px", left: "218px", size: "small", name: "V√¥mer" },
                        { top: "180px", left: "300px", size: "small", name: "Fossa mandibular" },
                        { top: "225px", left: "180px", size: "small", name: "Canal do nervo hipoglosso" },
                        { top: "235px", left: "255px", size: "small", name: "C√¥ndilo occipital" },
                        { top: "145px", left: "261px", size: "small", name: "L√¢mina lateral do processo pterigoide do esfenoide" },
                        { top: "145px", left: "243px", size: "small", name: "L√¢mina medial do processo pterigoide do esfenoide" },
                        { top: "210px", left: "295px", size: "small", name: "Processo estiloide do temporal" },
                        { top: "240px", left: "320px", size: "small", name: "Processo mastoide do temporal" },
                        { top: "170px", left: "175px", size: "small", name: "Forame oval" },
                        { top: "175px", left: "196px", size: "small", name: "Forame l√°cero" },
                        { top: "180px", left: "160px", size: "small", name: "Forame espinhoso" },
                        { top: "205px", left: "167px", size: "small", name: "Forame carot√≠deo" },
                        { top: "215px", left: "270px", size: "small", name: "Forame jugular" },
                        { top: "240px", left: "220px", name: "Forame magno" },
                        { top: "52px", left: "215px", size: "small", name: "Sutura palatina mediana" },
                        { top: "95px", left: "200px", size: "small", name: "Sutura palatina transversa" },
                        { top: "60px", left: "190px", name: "Processo palatino da maxila" },
                        { top: "120px", left: "218px", size: "small", name: "Espinha nasal posterior" },
                    ]
                },
                superior: {
                    image: "https://i.imgur.com/xNVouFu.png", // Link da vista superior
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "100px", left: "220px", size: "small", name: "V√©rtix" },
                        { top: "50px", left: "210px", size: "small", name: "Dr√©gma" },
                        { top: "280px", left: "240px", size: "small", name: "L√¢mbda" },
                        { top: "150px", left: "230px", name: "Sutura sagital" },
                        { top: "150px", left: "280px", size: "large", name: "Emin√™ncia parietal" },
                    ]
                },
                calota_craniana: {
                    image: "https://i.imgur.com/pEk7trI.png", //Link da vista da calota craniana
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points:[
                        { top: "200px", left: "200px", size: "small", name: "Sulco sagital" },
                        { top: "175px", left: "180px", size: "small", name: "F√≥vea granular" },
                        { top: "240px", left: "90px", size: "small", name: "Sulco vascular" },
                    ]
                },
                interior: {
                    image: "https://i.imgur.com/VTlPdSn.png", //Link da vista interior
                    background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                    points: [
                        { top: "100px", left: "190px", size: "small", name: "Crista etmoidal" },
                        { top: "110px", left: "200px", size: "small", name: "L√¢mina crivosa do etmoide" },
                        { top: "160px", left: "225px", size: "small", name: "Processo clinoide anterior da sela turca" },
                        { top: "145px", left: "235px", size: "small", name: "Asa menor do esfenoide" },
                        { top: "160px", left: "170px", size: "small", name: "Forame √≥ptico" },
                        { top: "175px", left: "160px", size: "small", name: "Forame redondo" },
                        { top: "160px", left: "260px", size: "small", name: "Asa maior do esfenoide" },
                        { top: "200px", left: "143px", size: "small", name: "Forame oval" },
                        { top: "215px", left: "135px", size: "small", name: "Forame espinhoso" },
                        { top: "200px", left: "220px", size: "small", name: "Forame l√°cero" },
                        { top: "195px", left: "200px", size: "small", name: "Processo clinoide posterior da sela turca" },
                        { top: "270px", left: "190px", name: "Forame magno" },
                        { top: "258px", left: "140px", size: "small", name: "Forame jugular" },
                        { top: "240px", left: "140px", size: "small", name: "Meato ac√∫stico interno" },
                        { top: "205px", left: "170px", size: "small", name: "Impress√£o trigeminal" },
                        { top: "100px", left: "120px", size: "large", name: "Fossa craniana anterior" },
                        { top: "215px", left: "70px", size: "large", name: "Fossa craniana m√©dia" },
                        { top: "350px", left: "120px", size: "large", name: "Fossa craniana posterior" },
                        { top: "258px", left: "100px", size: "small", name: "Rochedo temporal" },
                        { top: "225px", left: "300px", size: "small", name: "Corpo do esfenoide" },
                        { top: "350px", left: "250px", name: "Fossa cerebelar" },
                        { top: "400px", left: "220px", size: "small", name: "Sulco transverso" },
                        { top: "290px", left: "290px", size: "small", name: "Sulco do seio sigm√≥ide" },
                        { top: "235px", left: "190px", size: "small", name: "Clivo" },
                        { top: "220px", left: "200px", size: "small", name: "Dorso do esfenoide" },
                        { top: "180px", left: "190px", size: "small", name: "Fossa hipofis√°ria" },
                        { top: "150px", left: "120px", size: "small", name: "Fissura orbital superior" },
                    ]
                }
            },
        
                    medula: {
                        
                        coluna_espinal_completa: {
                        image: "https://i.imgur.com/ZDKJLSM.png", // Link da imagem da vista anterior
                        background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                        points: [
                        { top: "100px", left: "200px", size: 'small', name: "Rad√≠culas sensitivas" },
                        { top: "200px", left: "210px", size: 'small', name: "G√¢nglio sensitivo" },
                        { top: "240px", left: "215px", size: 'small', name: "G√¢nglio motor" },
                        { top: "207px", left: "240px", size: 'small', name: "Nervo espinal" },
                        { top: "230px", left: "190px", size: 'small', name: "Plexo venoso vertebral" },
                        { top: "403px", left: "190px", size: 'small', name: "Cone medular" },
                        { top: "430px", left: "210px", size: 'small', name: "Segunda vertebra lombar" },
                        { top: "430px", left: "193px", size: 'small', name: "Filamento terminal" },
                        { top: "500px", left: "190px", name: "Cauda equina" },
                        { top: "550px", left: "190px", size: 'small', name: "Fundo de saco dural" },
                        { top: "327px", left: "200px", size: 'small', name: "Forame intervertebral" },
                        { top: "380px", left: "200px", size: 'small', name: "Bainha da duramater" },
                        // Adicione mais pontos conforme necess√°rio
                        ]
                    },

                        vista_superior: {
                            image: "https://i.imgur.com/MnS2XJg.png",
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "100px", left: "270px", name: "Fissura mediana anterior" },
                            { top: "300px", left: "270px", name: "Sulco mediano posterior" },
                            { top: "80px", left: "310px", size: 'large', name: "Fun√≠culo anterior" },
                            { top: "87px", left: "140px", name: "Sulco lateral anterior" },
                            { top: "350px", left: "210px", name: "Sulco interm√©dio posterior" },
                            { top: "356px", left: "410px", name: "Sulco lateral posterior" },
                            { top: "200px", left: "450px", size: 'large', name: "Funiculo lateral" },
                            { top: "350px", left: "290px", name: "Fasc√≠culo gr√°ceo" },
                            { top: "350px", left: "360px", name: "Fasc√≠culo cuneiforme" },
                            { top: "110px", left: "200px", name: "Corno anterior" },
                            { top: "180px", left: "120px", name: "Corno lateral" },
                            { top: "300px", left: "140px", name: "Corno posterior" },
                            { top: "200px", left: "240px",name: "Subst√¢ncia cinzenta interm√©dia central" },
                            { top: "190px", left: "180px", name: "Subst√¢ncia cinzenta interm√©dia lateral" },
                            { top: "250px", left: "310px", name: "Comissura branca posterior" },
                            { top: "176px", left: "300px", size: 'small', name: "Comissura branca anterior" },
                            { top: "200px", left: "270px", size: 'small', name: "Canal central da medula" },
                            ]
                        },

                        vista_anterior_nervos: {
                            image: "https://i.imgur.com/aUarpkr.png",
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "250px", left: "360px", name: "Art√©ria e veia espinal anterior" },
                            { top: "50px", left: "500px", name: "Rad√≠culas sensitivas" },
                            { top: "220px", left: "150px", name: "Ra√≠z anterior" },
                            { top: "207px", left: "206px", size: 'small', name: "Ra√≠z posterior" },
                            { top: "200px", left: "160px", name: "G√¢nglio sensitivo" },
                            { top: "100px", left: "655px", name: "Nervo espinal" },
                            ]
                        },
                        
                        vista_posterior_sem_nervos: {
                            image: "https://i.imgur.com/HQpThdt.png",
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "340px", left: "355px", size: "small", name: "Ligamento denticulado" },
                            { top: "350px", left: "250px", size: "large", name: "Pia-m√°ter" },
                            { top: "430px", left: "220px", size: "large", name: "Aracnoide" },
                            { top: "490px", left: "220px", size: "large", name: "Dura-m√°ter" },
                            { top: "470px", left: "200px", size: "small", name: "Espa√ßo sub-dural" },
                            { top: "400px", left: "200px", size: "small", name: "Espa√ßo sub-aracnoideo" },
                            { top: "250px", left: "230px", name: "Sulco mediano posterior" },
                            { top: "250px", left: "290px", name: "Sulco interm√©dio posterior" },
                            { top: "250px", left: "360px", name: "Sulco lateral posterior" },
                            ]

                        }
                    },

                    v√©rtebra: {

                        vertebra_atlas: {
                            image: "https://i.imgur.com/FRrJ4BQ.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { "top": "10px", left: "250px", name: "Tub√©rculo anterior" },
                            { "top": "20px", left: "290px", name: "Arco anterior do atlas" },
                            { "top": "100px", left: "30px", name: "Processo transverso do atlas" },
                            { "top": "110px", left: "80px", name: "Forame transverso" },
                            { "top": "200px", left: "150px", name: "Arco posterior" },
                            { "top": "50px", left: "150px", size: "large", "name": "Face articular do processo articular superior" },
                            { "top": "270px", left: "260px", name: "Tub√©rculo posterior" },
                            { "top": "150px", left: "260px", size: "large", name: "Forame vertebral" }
                            ]
                        },

                        vertebra_axis: {
                            image: "https://i.imgur.com/mitBolx.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { "top": "50px", left: "240px", size: "large", name: "Dente do axis" },
                            { "top": "150px", left: "400px", size: "large", name: "Processo articular superior" },
                            { "top": "375px", left: "250px", name: "Arco do axis" },
                            { "top": "445px", left: "250px", size: "large", name: "Processo espinhoso" },
                            ]
                        },

                        vertebra_axis_inferior: {
                            image: "https://i.imgur.com/NARdJmW.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "80px", left: "240px", size: "large", name: "Corpo da v√©rtebra" },
                            { top: "110px", left: "350px", size: "large", name: "Forame transverso" },
                            { top: "110px", left: "420px", name: "Processo transverso" },
                            { top: "340px", left: "230px", size: "large", name: "Processo espinhoso" },
                            { top: "210px", left: "100px", size: "large", name: "Processos articulares inferiores" },
                            ]
                        },

                        vertebra_tipica: {
                            image: "https://i.imgur.com/fTDuE73.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "280px", left: "250px", size: "large", name: "Processo espinhoso" },
                            { top: "130px", left: "100px", size: "large", name: "Processo transverso" },
                            { top: "60px", left: "250px", size: "large", name: "Corpo da v√©rtebra" },
                            { top: "200px", left: "200px", size: "large", name: "L√¢mina" },
                            { top: "80px", left: "170px",  size: "large", name: "Face articular superior" },
                            { top: "120px", left: "240px", size: "large", name: "Forame intervertebral" },
                            ]
                        },

                        vertebra_tipica_inferior: {
                            image: "https://i.imgur.com/XVPCB5M.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "250px", left: "250px", size: "large", name: "Corpo" },
                            { top: "130px", left: "190px", name: "Ped√≠culo" },
                            { top: "90px", left: "50px", size: "large", name: "F√≥vea costal do processo transverso" },
                            { top: "150px", left: "250px", size: "large", name: "Forame intervertebral" },
                            { top: "160px", left: "185px", size: "small", name: "F√≥vea costal superior" },
                            { top: "100px", left: "240px", size: "large", name: "√Çngulo da face articular" },
                            { top: "100px", left: "180px", name: "Processo articular superior" },
                            ]
                        },

                        vertebra_sacral: {
                            image: "https://i.imgur.com/etzNCs6.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "30px", left: "250px", size: "large", name: "Promont√≥rio" },
                            { top: "20px", left: "330px", size: "small", name: "Processo articular superior" },
                            { top: "50px", left: "430px", size: "large", name: "Asa" },
                            { top: "90px", left: "360px", name: "Parte sacral da margem p√©lvica" },
                            { top: "260px", left: "310px", name: "Forame sacral anterior" },
                            { top: "225px", left: "250px", name: "Cristas transversas" },
                            { top: "340px", left: "250px", size: "large", name: "√Åpice do Sacro" },
                            { top: "400px", left: "290px", name: "Processo transverso do c√≥ccix" },
                            ]
                        },

                        vertebra_sacral_posterior: {
                            image: "https://i.imgur.com/G5G9Gcq.png", /*add image*/
                            background: "https://i.imgur.com/PUf8wJf.jpg", // Background da fase
                            points: [
                            { top: "40px", left: "340px", size: "large", name: "Faces dos processos articulares superiores" },
                            { top: "100px", left: "50px", size: "large", name: "Superf√≠cie auricular" },
                            { top: "300px", left: "150px", size: "large", name: "Forame sacral posterior" },
                            { top: "250px", left: "60px", size: "large", name: "Crista sacral lateral" },
                            { top: "250px", left: "230px", size: "large", name: "Crista sacral mediana" },
                            { top: "450px", left: "200px", name: "Corno sacral" },
                            { top: "250px", left: "190px", name: "Crista sacral interm√©dia" },
                            { top: "490px", left: "220px", name: "Corno cocc√≠geo" },
                            { top: "500px", left: "200px", name: "Processo transverso do c√≥ccix" },
                            ]
                        },

                    }
             }

        let currentPhase = null;
        let currentView = null;
        let currentMode = null;
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let shuffledPoints = [];
        let dialogueIndex = 0;

        function playBackgroundMusic() {
            const backgroundMusic = document.getElementById("background-music");
            if (backgroundMusic) {
                // Tenta reproduzir o √°udio
                backgroundMusic.play().then(() => {
                    console.log("M√∫sica iniciada com sucesso!");
                    // Remove o mudo ap√≥s iniciar a reprodu√ß√£o
                    backgroundMusic.muted = false;
                }).catch((error) => {
                    console.error("Erro ao iniciar a m√∫sica:", error);
                });
            }
        }

        // Tenta reproduzir a m√∫sica assim que a p√°gina carrega
        window.onload = () => {
            playBackgroundMusic();
        };
        
        const dialogues = [
            { text: "Bem-vindo ao Hospital Geral. Sou a Dr¬™ Isabella. Fiquei sabendo que √© o novo estagi√°rio, prazer.", background: "https://i.imgur.com/XM1jcWJ.jpg" },
            { text: "Acredito que esteja um pouco nervoso, mas vou te ajudar, n√£o se preocupe.", background: "https://i.imgur.com/XM1jcWJ.jpg" },
            { text: "Antes que possa ver os pacientes, acho uma boa ideia revisarmos o b√°sico. A come√ßar por", background: "https://i.imgur.com/XM1jcWJ.jpg" },
            { text: "Aqui voc√™ pode aprender sobre a anatomia dos principais sistemas do corpo.", background: "https://i.imgur.com/XM1jcWJ.jpg" },
            { text: "O que voc√™ gostaria de aprender hoje?", background: "https://i.imgur.com/XM1jcWJ.jpg" }
        ];

        function showSubMenu() {
            document.getElementById("menu").style.display = "none";
            document.getElementById("visual-novel").style.display = "flex";
            nextDialogue();
        }

        function nextDialogue() {
            if (dialogueIndex < dialogues.length) {
                const currentDialogue = dialogues[dialogueIndex];
                document.getElementById("dialogue-text").innerText = currentDialogue.text;
                document.getElementById("visual-novel-background").style.backgroundImage = `url('${currentDialogue.background}')`;
                dialogueIndex++;
            } else {
                showVisualNovelChoice();
            }
        }

        function showVisualNovelChoice() {
            document.getElementById("visual-novel").style.display = "none";
            document.getElementById("visual-novel-choice").style.display = "flex";
            document.getElementById("visual-novel-choice-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;
        }

        function backToMenu() {
            // Esconde o jogo e outros menus
            document.getElementById("game").style.display = "none";
            document.getElementById("cranio-sublevel-choice").style.display = "none";
            document.getElementById("medula-sublevel-choice").style.display = "none";
            document.getElementById("vertebra-sublevel-choice").style.display = "none";
            document.getElementById("mode-menu").style.display = "none";

            // Exibe o menu principal
            document.getElementById("menu").style.display = "flex";

            // Restaura o background do menu principal
            document.body.style.backgroundImage = "url('https://i.imgur.com/naeZ29X.jpg')";

            // Reseta o jogo
            resetGame();
}

        function chooseCranioSublevel() {
            document.getElementById("visual-novel-choice").style.display = "none";
            document.getElementById("cranio-sublevel-choice").style.display = "flex";
            document.getElementById("cranio-sublevel-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;
        }

        function chooseMedulaSublevel() {
            document.getElementById("visual-novel-choice").style.display = "none";
            document.getElementById("medula-sublevel-choice").style.display = "flex";
            document.getElementById("medula-sublevel-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;
        }

        function chooseVertebraSublevel() {
            document.getElementById("visual-novel-choice").style.display = "none";
            document.getElementById("vertebra-sublevel-choice").style.display = "flex";
            document.getElementById("vertebra-sublevel-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;
        }

        function chooseMode(phase, view) {
            currentPhase = phase;
            currentView = view;
            document.getElementById("cranio-sublevel-choice").style.display = "none";
            document.getElementById("medula-sublevel-choice").style.display = "none";
            document.getElementById("vertebra-sublevel-choice").style.display = "none";
            document.getElementById("mode-menu").style.display = "flex";
            document.getElementById("mode-menu-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;
        }

        function backToVisualNovelChoice() {
            document.getElementById("cranio-sublevel-choice").style.display = "none";
            document.getElementById("medula-sublevel-choice").style.display = "none";
            document.getElementById("vertebra-sublevel-choice").style.display = "none";
            document.getElementById("visual-novel-choice").style.display = "flex";
        }

        function backToSublevelChoice() {
            // Esconde o menu de escolha de modo
            document.getElementById("mode-menu").style.display = "none";

            // Exibe o submenu de sele√ß√£o de fase correspondente √† fase atual
            if (currentPhase === "cranio") {
                document.getElementById("cranio-sublevel-choice").style.display = "flex";
            } else if (currentPhase === "medula") {
                document.getElementById("medula-sublevel-choice").style.display = "flex";
            } else if (currentPhase === "v√©rtebra") {
                document.getElementById("vertebra-sublevel-choice").style.display = "flex";
            }

            // Restaura o background do submenu
            document.getElementById("visual-novel-choice-background").style.backgroundImage = `url('${dialogues[dialogues.length - 1].background}')`;

            // Reseta o jogo
            resetGame();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1)); // Escolhe um √≠ndice aleat√≥rio
                [array[i], array[j]] = [array[j], array[i]]; // Troca os elementos
            }
            return array;
        }

        function startGame(phase, view, mode) {
            // Verifica se a fase e a visualiza√ß√£o existem
            if (!phases[phase] || !phases[phase][view]) {
                console.error(`Fase ou visualiza√ß√£o n√£o encontrada: ${phase} - ${view}`);
                alert("Erro: Fase ou visualiza√ß√£o n√£o encontrada. Verifique a configura√ß√£o do jogo.");
                return;
            }

            resetGame();
            currentPhase = phase;
            currentView = view;
            currentMode = mode;

            // Configura o jogo
            document.getElementById("mode-menu").style.display = "none";
            document.getElementById("game").style.display = "block";
            document.getElementById("game").classList.add("active");

            document.getElementById("image").src = phases[phase][view].image;
            correctAnswers = 0;
            totalQuestions = phases[phase][view].points.length;
            shuffledPoints = shuffleArray([...phases[phase][view].points]);
            currentQuestionIndex = 0;

            if (mode === 'prova') {
                startProvaQuestion();
            } else if (mode === 'escrita') {
                startWritingMode();
            } else {
                loadQuestions();
            }
        }

        let timer; // Vari√°vel para armazenar o temporizador
        let timeLeft = 30; // Tempo inicial

        function startProvaMode() {
            // Verifica se o objeto phases existe
            if (!phases) {
                console.error("Erro: O objeto phases n√£o est√° definido.");
                return;
            }

            // Coleta TODAS as quest√µes de todas as fases
            const allQuestions = [];
            
            // Fases dispon√≠veis (ajuste os nomes conforme seu objeto phases)
            const phasesList = ["cranio", "medula", "v√©rtebra"];
            
            // Percorre cada fase e visualiza√ß√£o para coletar as quest√µes
            phasesList.forEach(phase => {
                // Verifica se a fase existe
                if (!phases[phase]) {
                    console.error(`Fase n√£o encontrada: ${phase}`);
                    return; // Pula para a pr√≥xima fase
                }

                // Obt√©m as visualiza√ß√µes da fase
                const views = Object.keys(phases[phase]);
                
                // Percorre cada visualiza√ß√£o
                views.forEach(view => {
                    // Verifica se a visualiza√ß√£o existe
                    if (!phases[phase][view]) {
                        console.error(`Visualiza√ß√£o n√£o encontrada: ${phase} - ${view}`);
                        return; // Pula para a pr√≥xima visualiza√ß√£o
                    }

                    // Obt√©m as quest√µes da visualiza√ß√£o
                    const questions = phases[phase][view].points;
                    
                    // Adiciona todas as quest√µes ao array
                    questions.forEach(question => {
                        allQuestions.push({
                            phase: phase, // Adiciona a fase
                            view: view,   // Adiciona a visualiza√ß√£o
                            question: question // Adiciona a quest√£o
                        });
                    });
                });
            });
            
            // Seleciona 20 quest√µes aleat√≥rias
            const selectedQuestions = shuffleArray(allQuestions).slice(0, 20);
            
            // Configura o modo PROVA
            resetGame();
            currentMode = "prova";
            shuffledPoints = selectedQuestions;
            totalQuestions = 20;
            currentQuestionIndex = 0;
            
            // Prepara a interface
            document.getElementById("mode-menu").style.display = "none";
            document.getElementById("game").style.display = "block";
            document.getElementById("game").classList.add("active");
            document.getElementById("timer").style.display = "block";
            
            // Inicia a primeira pergunta
            startProvaQuestion();
        }

        function startProvaQuestion() {
            // Limpa o temporizador anterior
            if (timer) clearInterval(timer);

            // Reseta o tempo
            let timeLeft = 30;
            document.getElementById("time").innerText = timeLeft;

            // Atualiza o temporizador
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById("time").innerText = timeLeft;

                // Tempo esgotado
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    handleProvaAnswer(); // Trata como resposta incorreta
                }
            }, 1000);

            // Limpa elementos anteriores
            const inputContainer = document.getElementById("input-container");
            if (inputContainer) inputContainer.remove();

            // Configura a pergunta atual
            const currentQuestion = shuffledPoints[currentQuestionIndex];

            // Verifica se a pergunta atual existe
            if (!currentQuestion) {
                console.error("Erro: Quest√£o atual n√£o encontrada.");
                return;
            }

            // Define a imagem da visualiza√ß√£o atual
            const phaseData = phases[currentQuestion.phase][currentQuestion.view];
            document.getElementById("image").src = phaseData.image;

            // Exibe o ponto piscando
            const targetsContainer = document.getElementById("targets");
            targetsContainer.innerHTML = ""; // Limpa os pontos anteriores

            const target = document.createElement("div");
            target.className = "target blinking";
            target.style.top = currentQuestion.question.top; // Posi√ß√£o Y do ponto
            target.style.left = currentQuestion.question.left; // Posi√ß√£o X do ponto
            target.style.width = "20px"; // Tamanho do ponto
            target.style.height = "20px";
            targetsContainer.appendChild(target);

            document.getElementById("question").innerHTML = `Digite o nome da estrutura que est√° piscando:`;

            // Cria o campo de input
            const newInputContainer = document.createElement("div");
            newInputContainer.id = "input-container";

            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = "Digite aqui...";

            const submitButton = document.createElement("button");
            submitButton.innerText = "Enviar";

            // Envio da resposta (Enter ou clique)
            const submitAnswer = () => {
            clearInterval(timer);
            const userAnswer = input.value.trim().toLowerCase();
            const correctAnswer = currentQuestion.question.name.toLowerCase();

            // Verifica se h√° input
            if (!userAnswer) {
                alert("Por favor, digite uma resposta!");
                return; // Impede o envio de respostas vazias
            }

            // Verifica se a resposta est√° correta
            const feedback = document.getElementById("feedback");
            if (checkSimilarity(userAnswer, correctAnswer)) {
                feedback.innerText = `Correto! A estrutura √©: ${currentQuestion.question.name}`;
                feedback.style.color = 'green'; // Cor verde para acerto
                correctAnswers++;
                document.getElementById("correct-sound").play();
            } else {
                feedback.innerText = `Incorreto! A estrutura correta √©: ${currentQuestion.question.name}`;
                feedback.style.color = 'red'; // Cor vermelha para erro
                document.getElementById("wrong-sound").play();
            }

            // Atualiza a interface
            updateProgressBar();
            updateScore();

            // Pr√≥xima pergunta ou fim do jogo
            currentQuestionIndex++;
            if (currentQuestionIndex < 20) {
                setTimeout(startProvaQuestion, 1000); // Aguarda 1 segundo
            } else {
                showEndGame();
            }
        };

            input.addEventListener("keypress", (e) => {
                if (e.key === "Enter") submitAnswer();
            });
            submitButton.addEventListener("click", submitAnswer);

            // Adiciona elementos √† tela
            newInputContainer.appendChild(input);
            newInputContainer.appendChild(submitButton);
            document.getElementById("question-container").appendChild(newInputContainer);
            input.focus(); // Define o foco manualmente
        }

        function loadQuestions() {
            // Remove a caixa de entrada do modo de escrita, se existir
            const inputContainer = document.getElementById("input-container");
            if (inputContainer) {
                inputContainer.remove();
            }

            // Resto do c√≥digo da fun√ß√£o loadQuestions
            const phaseData = phases[currentPhase][currentView];
            const targetsContainer = document.getElementById("targets");
            targetsContainer.innerHTML = "";
            document.getElementById("feedback").innerText = '';

            const currentQuestion = shuffledPoints[currentQuestionIndex];
            phaseData.points.forEach(point => {
                const target = document.createElement("div");
                target.className = "target";

                // Ajusta o tamanho do ponto
                if (point.size === "small") {
                    target.style.width = "15px";
                    target.style.height = "15px";
                } else if (point.size === "large") {
                    target.style.width = "30px";
                    target.style.height = "30px";
                } else {
                    target.style.width = "20px";
                    target.style.height = "20px";
                }

                target.style.top = point.top;
                target.style.left = point.left;
                target.onclick = () => checkAnswer(point.name, target);
                targetsContainer.appendChild(target);
            });

    let questionText = `Clique no ponto correspondente a: <span class="structure-name">${currentQuestion.name.toUpperCase()}</span>`;
    document.getElementById("question").innerHTML = questionText;
}
        function startWritingMode() {
            const targetsContainer = document.getElementById("targets");
            targetsContainer.innerHTML = "";

            const currentQuestion = shuffledPoints[currentQuestionIndex];
            const target = document.createElement("div");
            target.className = "target blinking"; // Adiciona a classe "blinking" para piscar
            target.style.top = currentQuestion.top;
            target.style.left = currentQuestion.left;
            target.style.width = "20px";
            target.style.height = "20px";
            targetsContainer.appendChild(target);

            // Remove a caixa de entrada anterior, se existir
            const existingInputContainer = document.getElementById("input-container");
            if (existingInputContainer) {
                existingInputContainer.remove();
            }

            // Exibe a pergunta
            document.getElementById("question").innerHTML = `Digite o nome da estrutura que est√° piscando:`;

            // Cria um campo de entrada para o jogador digitar
            const inputContainer = document.createElement("div");
            inputContainer.id = "input-container"; // Adiciona um ID para facilitar a remo√ß√£o
            inputContainer.style.marginTop = "20px";
            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = "Digite aqui...";
            input.style.padding = "10px";
            input.style.fontSize = "16px";
            input.style.borderRadius = "5px";
            input.style.border = "2px solid #800020";
            // Adiciona o evento de tecla pressionada ao campo de entrada
        input.addEventListener("keydown", (event) => {
        if (event.key === "Enter") { // Verifica se a tecla pressionada √© o Enter
        submitButton.click(); // Simula o clique no bot√£o "Enviar"
       }
        });
            const submitButton = document.createElement("button");
            submitButton.innerText = "Enviar";
            submitButton.style.padding = "10px 20px";
            submitButton.style.marginLeft = "10px";
            submitButton.style.backgroundColor = "#800020";
            submitButton.style.color = "white";
            submitButton.style.border = "none";
            submitButton.style.borderRadius = "5px";
            submitButton.style.cursor = "pointer";

            submitButton.onclick = () => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = currentQuestion.name.toLowerCase();

                // Verifica se a resposta est√° correta (com toler√¢ncia para pequenos erros)
                const isCorrect = checkSimilarity(userAnswer, correctAnswer);
                const feedback = document.getElementById("feedback");

                if (isCorrect) {
                    feedback.innerText = `Correto! A estrutura √©: ${currentQuestion.name}`;
                    feedback.style.color = 'green';
                    correctAnswers++;
                    document.getElementById("correct-sound").play();
                } else {
                    feedback.innerText = `Incorreto! A estrutura correta √©: ${currentQuestion.name}`;
                    feedback.style.color = 'red';
                    document.getElementById("wrong-sound").play();
                }

                // Aguarda 1 segundo antes de passar para a pr√≥xima pergunta
                setTimeout(() => {
                    currentQuestionIndex++;
                    updateProgressBar();
                    updateScore();
                    input.focus(); // Foca automaticamente no campo de entrada

                    if (currentQuestionIndex < shuffledPoints.length) {
                        startWritingMode(); // Carrega a pr√≥xima pergunta
                    } else {
                        showEndGame(); // Finaliza o jogo
                    }
                }, 1000);
            };

            inputContainer.appendChild(input);
            inputContainer.appendChild(submitButton);
            document.getElementById("question-container").appendChild(inputContainer);
        }

        function checkSimilarity(userAnswer, correctAnswer) {
            // Remove acentos e converte para min√∫sculas
            const normalize = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

            userAnswer = normalize(userAnswer);
            correctAnswer = normalize(correctAnswer);

            // Verifica se a resposta do usu√°rio est√° contida na resposta correta ou vice-versa
            return userAnswer.includes(correctAnswer) || correctAnswer.includes(userAnswer);
        }

        function checkAnswer(structure, target) {
            const phaseData = phases[currentPhase][currentView];
            const correctAnswer = shuffledPoints[currentQuestionIndex].name;
            const feedback = document.getElementById("feedback");

            if (structure === correctAnswer) {
                target.classList.add("correct");
                feedback.innerText = `Correto! A estrutura √©: ${correctAnswer}`;
                feedback.style.color = 'green';
                correctAnswers++;
                document.getElementById("correct-sound").play(); // Toca o som de acerto
            } else {
                target.classList.add("incorrect");
                feedback.innerText = `Incorreto! A estrutura correta √©: ${correctAnswer}`;
                feedback.style.color = 'red';
                document.getElementById("wrong-sound").play(); // Toca o som de erro
            }

            // Aguarda 1 segundo antes de trocar a pergunta e limpar o feedback
            setTimeout(() => {
                currentQuestionIndex++;
                updateProgressBar();
                updateScore();

                if (currentQuestionIndex < shuffledPoints.length) {
                    let questionText = `Clique no ponto correspondente a: <span class="structure-name">${shuffledPoints[currentQuestionIndex].name.toUpperCase()}</span>`;
                    document.getElementById("question").innerHTML = questionText;
                } else {
                    showEndGame();
                }
                // Limpa o feedback
                feedback.innerText = '';
            }, 1000);
        }

        function updateProgressBar() {
            const progressBar = document.getElementById("progress-bar");
            const percentage = (currentQuestionIndex / totalQuestions) * 100;
            progressBar.style.width = `${percentage}%`;
        }

        function updateScore() {
            const scoreElement = document.getElementById("score");
            const congratsElement = document.getElementById("congrats");
            let percentage = (correctAnswers / totalQuestions) * 100;
            scoreElement.innerText = `Acertos: ${correctAnswers} / ${totalQuestions} (${percentage.toFixed(0)}%)`;
            if (percentage === 100 && totalQuestions > 0) {
                congratsElement.style.display = "block";
                document.getElementById("victory-sound").play(); // Toca o som de vit√≥ria
            } else {
                congratsElement.style.display = "none";
            }
        }

        function showEndGame() {
            const feedback = document.getElementById("feedback");
            const voltarButton = document.getElementById("voltar-button");
            const continuarButton = document.getElementById("continuar-button");

            // Verifica se os elementos existem
            if (!feedback || !voltarButton || !continuarButton) {
                console.error("Elementos n√£o encontrados no DOM.");
                return;
            }

            feedback.innerText = `Jogo finalizado! Voc√™ acertou ${correctAnswers} de ${totalQuestions} pontos.`;
            feedback.style.color = correctAnswers === totalQuestions ? 'green' : 'red';

            // Esconde o bot√£o "Voltar" e mostra o bot√£o "Continuar"
            voltarButton.style.display = "none";
            continuarButton.style.display = "block";
        }

        function showFeedbackMedica() {
            const feedbackMedica = document.getElementById("feedback-medica");
            const medicSprite = document.getElementById("medic-sprite");
            const feedbackText = document.getElementById("feedback-text");

            // Verifica se os elementos existem
            if (!feedbackMedica || !medicSprite || !feedbackText) {
                console.error("Elementos do feedback da m√©dica n√£o encontrados no DOM.");
                return;
            }

            // Calcula a porcentagem de acertos
            const percentage = (correctAnswers / totalQuestions) * 100;

            // Define o sprite e a mensagem com base no desempenho
            if (percentage === 100) {
                medicSprite.src = "https://i.imgur.com/7kDMzXJ.jpg"; // Sprite feliz
                feedbackText.innerText = "Incr√≠vel! Voc√™ acertou todas as perguntas! Tenho certeza que o hospital estar√° em boas m√£os!";
            } else if (percentage >= 50) {
                medicSprite.src = "https://i.imgur.com/jR1uYPi.png"; // Sprite neutro
                feedbackText.innerText = "Bom trabalho! Voc√™ acertou a maioria das perguntas. Continue estudando!";
            } else {
                medicSprite.src = "https://i.imgur.com/5UAjfs9.png"; // Sprite triste
                feedbackText.innerText = "Voc√™ errou muitas perguntas. N√£o desanime! Revise o conte√∫do e tente novamente.";
            }

            // Exibe o feedback da m√©dica
            feedbackMedica.style.display = "flex";

            // Esconde o jogo
            const game = document.getElementById("game");
            if (game) {
                game.style.display = "none";
            }
        }

        function backToMenu() {
            // Esconde todos os menus e o jogo
            const elementsToHide = [
                "sub-menu", "cranio-sub-menu", "medula-sub-menu", 
                "vertebra-sub-menu", "mode-menu", "game", "feedback-medica"
            ];

            elementsToHide.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = "none";
                }
            });

            // Volta ao menu principal
            const menu = document.getElementById("menu");
            if (menu) {
                menu.style.display = "flex";
            }

            // Restaura o fundo
            document.body.style.backgroundColor = "#f0f0f0";
            document.body.style.backgroundImage = "url('https://i.imgur.com/naeZ29X.jpg')";

            // Reseta o jogo
            resetGame();
        }

        function backToSubMenu() {
            // Esconde o jogo
            const game = document.getElementById("game");
            if (game) {
                game.style.display = "none";
            }

            // Restaura o background do menu principal
            document.body.style.backgroundImage = "url('https://i.imgur.com/naeZ29X.jpg')";

            // Exibe o menu de sele√ß√£o de subn√≠vel correspondente √† fase atual
            if (currentPhase === "cranio") {
                const cranioSublevel = document.getElementById("cranio-sublevel-choice");
                if (cranioSublevel) {
                    cranioSublevel.style.display = "flex";
                }
            } else if (currentPhase === "medula") {
                const medulaSublevel = document.getElementById("medula-sublevel-choice");
                if (medulaSublevel) {
                    medulaSublevel.style.display = "flex";
                }
            } else if (currentPhase === "v√©rtebra") {
                const vertebraSublevel = document.getElementById("vertebra-sublevel-choice");
                if (vertebraSublevel) {
                    vertebraSublevel.style.display = "flex";
                }
            }

            // Reseta o jogo
            resetGame();
        }

        function resetGame() {
            currentPhase = null;
            currentView = null;
            currentMode = null;
            currentQuestionIndex = 0;
            correctAnswers = 0;
            totalQuestions = 0;
            shuffledPoints = [];
            const progressBar = document.getElementById("progress-bar");
            if (progressBar) {
                progressBar.style.width = "0%";
            }
        }

        // Garante que o script seja executado ap√≥s o carregamento do DOM
        window.onload = () => {
            // Inicializa o jogo
            checkMobileDevice();
            playBackgroundMusic();
        };
    </script>
</body>
</html>
